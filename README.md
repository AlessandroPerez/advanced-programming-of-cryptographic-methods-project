<img alt="" src="assets/logo/banner.png" width="100%"><br>

# Table of Contents

- [Introduction](#introduction)
- [Installation and Configuration](#installation-and-configuration)
  - [Getting Started](#getting-started)
  - [Configuration](#configuration)
  - [Installation](#installation)
    - [Installation with Docker (Recommended)](#installation-with-docker-recommended)
    - [Installation from Source](#installation-from-source)
- [Getting Started](#getting-started)
  - [Server](#server)
  - [Client](#client)
    - [Registration](#registration)
    - [Main Window](#main-window)
    - [Adding Friends](#adding-friends)
    - [Navigating Chats](#navigating-chats)
  - [Final Overview](#final-overview)
- [Resources](#resources)
  - [Report](#report)
  - [Documentation](#documentation)
- [Contacts](#contacts)

# Introduction

**T**he **R**ust **U**nique **S**ecure **T**alk (T.R.U.S.T.) is a secure chat application with a terminal user interface (TUI), developed in Rust. This project focuses on exploring secure communication principles and implementing a robust end-to-end encryption system for reliable and private messaging. <br>
The core of the project revolves around the **Extended Triple Diffie-Hellman** (**X3DH**) protocol for secure key establishment and **Double Ratchet** protocol for frequent key update. Once a shared secret is established, the application switches to **AES-GCM** for symmetric message encryption. Together, these algorithms ensure end-to-end confidentiality and integrity of all communications.

# Installation and Configuration

## Getting Started

1. Clone the repository:

```bash
git clone https://github.com/christiansassi/advanced-programming-of-cryptographic-methods-project
```

2. Navigate to the project directory:

```bash
cd advanced-programming-of-cryptographic-methods-project
```

## Configuration

Modify the [config.toml](config/config.toml) file located in the [config](config) directory to adjust the application settings:

- `server_ip`: The IP address of the server (default: `server`). If you do not plan to use Docker (see [Installation from Source](#installation-from-source)), set this to `127.0.0.1` or another valid IP address.
- `server_port`: The port on which the server listens (default: `3333`).
- `log_level`: The logging level (default: `info`).

> [!WARNING]  
> Do not modify `private_key_server` and `public_key_server`. These values are automatically generated by the updater.

## Installation

You can choose between installing the project using Docker (the default and recommended method) or building the executables manually. The Docker-based approach is recommended because it minimizes compatibility issues by encapsulating all dependencies within containers. Local installation is less user-friendly but still fully functional. All installation methods offer the same features. Choose the one that best fits your environment and preferences.

> [!NOTE]  
> If you prefer not to use Docker and want to avoid building everything from source, pre-built binaries are available in the [target/release](target/release) folder, except for macOS. If you are using macOS, you will need to build the source files manually. See [Installation from Source](#installation-from-source).

### Installation with Docker (Recommended)

1. Verify that Docker is installed by running:

```bash
docker --version
``` 

2. Build the Docker image:

```bash
docker compose build --no-cache
``` 

3. Run the updater to generate server keys:

```bash
docker compose run --rm updater
``` 

4. Start the server and clients:

```bash
docker compose up server client1 client2
``` 

5. Open a new terminal and attach to the TUI of `client1`:

```bash
docker container attach client1
``` 

6. Repeat the previous step for `client2`, if desired.
7. To stop the containers, press `CTRL+C` in the terminal where you ran `docker compose up`, or run `docker compose down`.

### Installation from Source

1. Ensure that Rust and Cargo are installed by running:

```bash
rustc --version
cargo --version
```

2. Build all components ([server](server), [tui](tui), [updater](updater)) by running the following command from the root fo the repository:

```bash
cargo build --release
``` 

3. The built executables will be located in the [target/release](target/release) folder.

    1. First, update the server keys by running the `updater` executable.
    2. Then, start the server by running the `server` executable.
    3. Finally, run any number of clients (as needed) using the `tui` executable.

# Getting Started

### Server

<img alt="" src="assets/screenshots/server.png" width="100%">

### Client

The client operates in two modes:

- **NORMAL**: Entered by pressing the `ESC` key. This mode allows interaction with the TUI. For a list of available key combinations, check the bottom of the TUI for instructions relevant to the current window.

- **INPUT**: Entered by pressing the `i` key. As the name suggests, this mode allows you to input text into the application’s input fields.

#### Registration

Before using the client, you need to register by choosing a unique username. Usernames must be non-empty and unique—multiple users cannot share the same username simultaneously.

<img alt="Registration Screen" src="assets/screenshots/registration.png" width="100%">

#### Main Window

After registration, you'll be taken to the main window. Initially, your chats list will be empty.

<img alt="Empty Chat List" src="assets/screenshots/no_chats.png" width="100%">

#### Adding Friends

To start chatting, you can add new friends at any time by pressing the `a` key in `NORMAL` mode.

> [!WARNING]  
> The person you want to chat with **must be online**.

<img alt="Add a Friend" src="assets/screenshots/add_a_friend.png" width="100%">

#### Navigating Chats

While in `NORMAL` mode:
- Use the **left/right arrow keys** to switch between the chats list and the selected chat.
- In the chats list:
    - Use the **up/down arrow keys** to navigate through your chats.
    - Press `ENTER` to select a chat and start messaging.

<img alt="Chat Interface" src="assets/screenshots/chat.png" width="100%">

### Final Overview

Here's an overview of the server and clients in action (with two clients for demonstration purposes):

<img alt="Server and Clients Overview" src="assets/demo/demo.gif" width="100%">

# Resources

## Report
[Report](report/main.pdf)

## Documentation
[The Rust Unique Secure Talk (T.R.U.S.T.)](https://christiansassi.github.io/advanced-programming-of-cryptographic-methods-project/)

# Contacts

Matteo Bordignon - [matteo.bordignon@studenti.unitn.it](mailto:matteo.bordignon@studenti.unitn.it)

Alessandro Perez - [alessandro.perez@studenti.unitn.it](mailto:alessandro.perez@studenti.unitn.it)

Christian Sassi - [christian.sassi@studenti.unitn.it](mailto:christian.sassi@studenti.unitn.it)

<picture>
    <source media="(prefers-color-scheme: dark)" srcset="assets/extras/dark.png">
    <img alt="https://www.unitn.it/" src="assets/extras/light.png" width="300px">
</picture>
